{"version":3,"sources":["login.js"],"names":["isLogin","checkLogin","tokenData","JSON","parse","localStorage","getItem","window","location","pathname","replace","checkRole","url","role","toUpperCase","trim","accessUrl","checkAccessPage","logout","removeItem","array","isAccess","forEach","includes","el","showMessage","text","container","$","removeClass","find","html","addClass","document","ready","submit","e","preventDefault","username","val","password","ajax","EBSMSLocal","method","data","stringify","contentType","dataType","then","a","b","c","status","setItem"],"mappings":"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","file":"login.js","sourcesContent":["const isLogin = false;\r\n\r\nvar checkLogin = function () {\r\n    const tokenData = JSON.parse(localStorage.getItem('TOKEN_DATA'));\r\n    if (!tokenData) {\r\n        if (window.location.pathname !== '/login.html') {\r\n            window.location.replace('login.html');\r\n        }\r\n    }\r\n    checkRole(tokenData);\r\n};\r\ncheckLogin();\r\nfunction checkRole(tokenData) {\r\n    const url = window.location.pathname;    \r\n    if (tokenData && tokenData.role) {\r\n        switch (tokenData.role.toUpperCase().trim()) {\r\n            case 'HOSPITALSTAFF': {\r\n                const accessUrl = ['importList.html','importDetail.html'];\r\n                if (!checkAccessPage(accessUrl, url)) {\r\n                    window.location.replace(accessUrl[0]);\r\n                };\r\n                break;\r\n            }\r\n            case 'MEDICALSUPPLIER': {\r\n                const accessUrl = ['confirmMSRequest.html','requestDetail.html'];\r\n                if (!checkAccessPage(accessUrl, url)) {\r\n                    window.location.replace(accessUrl[0]);\r\n                };\r\n                break;\r\n            }\r\n            case 'CHIEFNURSE': {\r\n                const accessUrl = ['viewSchedule.html', 'viewScheduleItem.html', 'viewScheduleItem1.html',  'viewShiftNoSchedule.html'];\r\n                if (!checkAccessPage(accessUrl, url)) {\r\n                    window.location.replace(accessUrl[0]);\r\n                };\r\n                break;\r\n            }\r\n            default: window.location.replace('login.html'); break;\r\n        }\r\n    }\r\n}\r\n\r\nfunction logout (){\r\n    localStorage.removeItem('TOKEN_DATA');\r\n    window.location.replace('login.html');\r\n}\r\n\r\nfunction checkAccessPage (array, url) {\r\n    let isAccess = false;\r\n    array.forEach(el => {\r\n        if (url.includes(el)) {\r\n            isAccess = true;\r\n            return;\r\n        }\r\n    })\r\n    return isAccess;\r\n}\r\n\r\nfunction showMessage (text) {\r\n    const container = $('div[target=\"invalid-message\"]');\r\n    if (text) {\r\n        $(container).removeClass('d-none');\r\n        $(container).find('span').html(text);\r\n    } else {\r\n        $(container).addClass('d-none');\r\n    }\r\n}\r\n\r\n  $(document).ready(function() {\r\n$('#frmLogin').submit(function(e){\r\n    e.preventDefault();\r\n    const username = $('#username').val();\r\n    const password = $('#password').val();\r\n    showMessage(null);\r\n    if (username && password) {\r\n        $.ajax({\r\n            url: EBSMSLocal + '/api/Account/Login',\r\n            method: 'post',\r\n            data: JSON.stringify({ username: username, password: password }),\r\n            contentType: 'application/json',\r\n            dataType: 'json'\r\n        }).then((a, b, c) => {\r\n            if (c && c.status === 204) {\r\n                showMessage('Invalid username or password');\r\n            }\r\n            localStorage.setItem('TOKEN_DATA', JSON.stringify(a));\r\n            checkRole(a);\r\n        }, er => {\r\n            showMessage('Invalid username or password');\r\n        })\r\n    } else {\r\n        showMessage('You have to input username and password!!!');\r\n    }\r\n});\r\n});\r\ncheckLogin();"]}
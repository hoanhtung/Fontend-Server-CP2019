<!DOCTYPE html>
<html lang="en" data-textdirection="ltr" class="loading">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
  <meta name="description"
    content="Robust admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
  <meta name="keywords"
    content="admin template, robust admin template, dashboard template, flat admin template, responsive admin template, web app">
  <meta name="author" content="PIXINVENT">
  <title>Surgery Management System Project</title>

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-touch-fullscreen" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <!-- CSS Template -->
  <link rel="stylesheet" type="text/css" href="styles/template/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="fonts/icomoon.css">
  <link rel="stylesheet" type="text/css" href="fonts/flag-icon-css/css/flag-icon.css">
  <link rel="stylesheet" type="text/css" href="styles/template/bootstrap-extended.css">
  <link rel="stylesheet" type="text/css" href="styles/template/app.css">
  <link rel="stylesheet" type="text/css" href="styles/template/colors.css">
  <link rel="stylesheet" type="text/css" href="styles/template/menu/vertical-menu.css">
  <!-- ================================== -->
  <!-- Bower JS -->
  <script src="/bower_components/jquery/dist/jquery.js"></script>
  <script src="/bower_components/modernizr/modernizr.js"></script>
  <!-- JS Team -->
  <script src="./scripts/lib_utilities.js"></script>
  <script src="./scripts/tungJS.js"></script>
  <script src="./scripts/phucJS.js"></script>
  <script src="./scripts/linhJS.js"></script>
  <script src="./scripts/vinhJS.js"></script>
  <script src="./scripts/login.js"></script>
  
  <!-- ====================================== -->
  <link rel="stylesheet" type="text/css" href="styles/tungStyle.css">
  <link rel="stylesheet" href="styles/tungViewSchedule.css" type="text/css">

  <link href="https://fonts.googleapis.com/css?family=Ubuntu:400,700" rel="stylesheet">


  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">

  <script src="/bower_components/@aspnet/signalr/dist/browser/signalr.js"></script>
  <script src="./scripts/notifyMessage.js"></script>
  <!-- ================================== -->
  <script>
      $(function () {
          $("#header").load("./layout/header1.html");
          $("#navigation").load("./layout/nav.html");
          $("#footer").load("./layout/footer.html");

          $("#date-input").val(formatInputDate(new Date()));
          loadSurgeryRoom(convertDateToNumber(new Date()));
      });
      // setInterval(function(){ SendNotification() }, 1000);
  </script>
</head>

<body data-menu="vertical-menu" data-col="2-columns"
  class="vertical-layout vertical-menu 2-columns fixed-navbar">
  <nav id="header" class="header-navbar navbar navbar-with-menu navbar-fixed-top navbar-semi-dark navbar-shadow">
  </nav>
  <div id="navigation" data-scroll-to-active="true" class="main-menu menu-fixed menu-dark menu-accordion menu-shadow">
  </div>

  <div class="app-content content container-fluid">
    <div class="content-wrapper">
      <div class="content-header row">
        <div class="content-header-left col-md-12 col-xs-12 mb-1">
          <p style="text-align: center" class="h1 text-bold-200">Surgery Schedule</p>
          <input id="date-input" type="date" value="" onchange="getScheduleByDay()" />
          <div id="clock" style="float: right; font-size: 40px; font-weight: bold"></div>
          <br /><br />
          <button class="btn btn-warning" onclick="SendNotification()">Click on</button>
          <!-- <div id="div-notification">Kakaka</div> -->
          <!-- <input class="btn btn-success" type="submit" value="View Shift No Schedule"
              onClick="window.location.href = 'viewShiftNoSchedule.html';" />
          <input class="btn btn-success" id="swap-btn" type="submit" value="Swap Schedule" /> -->
          <input class="btn btn-primary" type="submit" value="Add Emergency Shift"
              id="addEmerTmpBtn" data-toggle="modal" data-target="#addEmergencyShift" />
          <br /> <br />
          <!-- Search funtion -->
          <input type="text" placeholder="Search" class="search-schedule-css" id="keyword"
              onkeyup="searchSchedule()" />

          <span id="searchError"
              style="margin-left: 20px; font-size: 25px; color: red; display: none">Not found
              surgery shift!</span>
          <!-- end of Search -->

          <div style="float: right">
              <div style="display: inline; float: left; margin-right: 20px">
                  <div
                      style="width: 30px; height: 20px; background-color: #ffeaa7; float: left; margin-right: 10px;">
                  </div><span><b>Proceeding</b></span>
              </div>
              <div style="display: inline;">
                  <div
                      style="width: 30px; height: 20px; background-color: #b2bec3; float: left; margin-right: 10px;">
                  </div><span><b>Completed</b></span>
              </div>
          </div>
        </div>
      </div>
      <div class="content-body">
        <div class="div-all-surgery-room" id="row-surgery-room">
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
 <!-- Modal Post status -->
<div class="modal fade" id="changePostStatusModal">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Change Postoperative Status</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <!-- Modal body -->
      <div class="modal-body">
        <div class="form-group">
          <span>Surgery Shift: <span id="surgery-shift-post-status"></span></span> <br />
          <span>Estimated Start Datetime: <span class="estimated-start-time"></span></span> <br />
          <span>Estimated End Datetime: <span class="estimated-end-time"></span></span>
        </div>
        <div class="form-group">
          <span><b>Actual End Time:</b></span>
          <input type="time" id="actual-end" class="form-control border-primary" />
        </div>
        <div class="row">
          <div class="form-group">
            <div class="col-md-6">
                <span><b>Room</b></span>
                <input type="text" id="roomPost" class="form-control border-primary" />
            </div>
            <div class="col-md-6">
                <span><b>Bed</b></span>
                <input type="text" id="bedPost" class="form-control border-primary" />
            </div>
          </div>
        </div>
      </div>
      <!-- Modal footer -->
      <div class="modal-footer">
        <button id="complete-surgery-btn" type="button" class="btn btn-primary"
            data-dismiss="modal">Complete Surgery Shift</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- Modal Intra status -->
<div class="modal fade" id="changeIntraStatusModal">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Change Intraoperative Status</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <!-- Modal body -->
      <div class="modal-body">
        <div class="form-group">
            <span>Surgery Shift: <span id="surgery-shift-intra-status"></span></span> <br />
            <span>Estimated Start Datetime: <span class="estimated-start-time"></span></span> <br />
            <span>Estimated End Datetime: <span class="estimated-end-time"></span></span>
        </div>
        <div class="form-group">
            <span><b>Actual Start Time:</b></span>
            <input type="time" id="actual-start" class="form-control" />
        </div>
      </div>
      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" id="change-intra-btn" class="btn btn-primary" data-dismiss="modal">Start
            Surgery Shift</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- Modal add emergency shift -->
<div class="modal fade" id="addEmergencyShift">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Add Emergency Shift</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <!-- Modal body -->
            <div class="modal-body">
              <div class="form-group">
                  <span><b>Patient's Identity Card Number</b></span>
                  <input type="text" class="form-control" name="emerPatientICN">
              </div>
              <div class="form-group">
                  <span><b>Patient's Name</b></span>
                  <input type="text" class="form-control" name="emerPatientName">
              </div>
              <div class="form-check-inline">
                  <label class="form-check-label" for="radio1">
                      <input type="radio" class="form-check-input" id="radio1" name="optradio" value="option1"
                          checked>Male
                  </label>
              </div>
              <div class="form-check-inline">
                  <label class="form-check-label" for="radio2">
                      <input type="radio" class="form-check-input" id="radio2" name="optradio"
                          value="option2">Female
                  </label>
              </div>
                <div class="form-group">
                    <span><b>Date</b></span>
                    <input type="date" class="form-control" name="scheduleDate">
                </div>
                <div class="form-group">
                    <span><b>Start Time:</b></span>
                    <input type="time" class="form-control" name="scheduleStartTime">
                </div>
                <div class="form-group">
                    <span><b>Expected Surgery Time Duration</b></span>
                    <input type="number" class="form-control" min="0" step="0.5" name="expectedDurationTime">
                </div>
                <div class="form-check">
                    <label class="form-check-label">
                        <input type="checkbox" class="form-check-input" name="chkForceAdd">Force Add Emergency
                    </label>
                </div>
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" id="emergency-btn" class="btn btn-primary" data-dismiss="modal">Add Emergency
                    Shift</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

  <!-- ========================= -->

<footer id="footer" class="footer footer-static footer-light navbar-border"></footer>

<!-- JS Template -->
<script src="./scripts/core/jquery.min.js"></script>
<script src="bower_components/tether/dist/js/tether.min.js" type="text/javascript"></script>
<script src="./scripts/core/libraries/bootstrap.min.js"></script>
<script src="bower_components/perfect-scrollbar/js/perfect-scrollbar.jquery.min.js" type="text/javascript"></script>
<script src="bower_components/unison/js/unison.min.js"></script>
<!-- ============================ -->

<script src="./scripts/core/app-menu.js" type="text/javascript"></script>
<script src="./scripts/core/app.js" type="text/javascript"></script>

<script>
  $('#addEmerTmpBtn').click(function () {
    $("[name='scheduleDate']").val(formatInputDate(new Date()));
    $("[name='scheduleStartTime']").val(new Date().toTimeString().split(' ')[0]);
  })

  // start surgery - set intra
  $('#change-intra-btn').click(function () {
    var id = $('#surgery-shift-intra-status').data('shiftId');
    var day = $('#surgery-shift-intra-status').data('day');
    var actualStartTime = $('#actual-start').val();
    var actualStartDatetime = day + ' ' + actualStartTime;
    startSurgeryShift(id, actualStartDatetime);
  });

  $('#complete-surgery-btn').click(function () {
    var id = $('#surgery-shift-post-status').data('shiftId');
    var day = $('#surgery-shift-post-status').data('day');
    var actualEndTime = $('#actual-end').val();
    var actualEndDatetime = day + ' ' + actualEndTime;
    setPostStatus(id, actualEndDatetime);
  });
  //------------------------------------------

  $('#changeIntraoperative').on('click', function () {
    var shiftId = $(this).data('shift-id');
    changeIntraoperative(shiftId, "Preoperative");
  })

  function convertDateStringToDate(dateString) {
    return new Date(dateString).getDate() + '/' + (new Date(dateString).getMonth() + 1) + '/' + new Date(dateString).getFullYear() + ' ' + new Date(dateString).getHours() + ' : ' + (new Date(dateString).getMinutes() > 10 ? new Date(dateString).getMinutes() : ('0' + new Date(dateString).getMinutes()));
  }
  function appendTimeAndDay(day, time) { //11/03/2019, 9:00 -> 2019-03-11T09:00Z
    var result = day.split("/");
    return result[2] + '-' + result[1] + '-' + result[0] + 'T' + time + 'Z';
  }

  $('#emergency-btn').click(function () {
    var scheduleDate = $('[name="scheduleDate"]').val();
    var startTime = $('[name="scheduleStartTime"]').val();
    var endTime = $('[name="scheduleEndTime"]').val();

    var duration = $('[name="expectedDurationTime"]').val();
    var chkForce = $('[name="chkForceAdd"]').is(":checked");
    console.log(chkForce);
    var startDateTime = scheduleDate + 'T' + startTime + 'Z';
    var tmpStart = new Date(startDateTime).getTime();
    var tmpEnd = new Date(tmpStart + duration * 60 * 60 * 1000);
    var endDateTime = tmpEnd.toISOString();
    AddEmergencyShift(startDateTime, endDateTime, chkForce);
})
</script>
</body>
</html>